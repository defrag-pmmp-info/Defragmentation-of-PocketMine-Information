# 実際にサーバーを立ててみよう
さて、実際にサーバーを作って遊んでみましょう。
完成形はこんなかんじ。
![完成図](/image/1FCB70B6-D6D5-48FF-8E59-8694F1D5F3FC.gif)

誰ですかこんなひどい絵を描いたのは。

それはさておき、左側から準備していきます。

## サーバーソフトの準備
[サーバーの立て方](/building/README.md)から見ることができます。  
また、Windowsであれば、ねらひかだ氏がインストーラーを開発しています。
[このページ](https://github.com/Nerahikada/PocketMine-MP_Installer/releases/latest)のPocketMine-MPなんとかかんとか.exeをダウンロードして実行すればインストールしてくれます。
<!-- ここ、不親切だけどどうしようか -->
<!-- TODO
## Bedrock Dedicated Serverでのサーバーの立て方 -->

## 試しに入ってみよう
それでは、試しにサーバーに入ってみましょう。

ところで、はじめてサーバーに入るときには「サーバーIPアドレス」とか「ポート」とかいうのを入力していたと思います。このIPアドレスは、サーバーの住所に当たる場所です。これがないとサーバーに入れないので、調べていきます。

今回は自宅サーバー(を想定)なのでルーターの内側(=上の図で緑の線で繋がってる所)で通用するIPアドレスを使います。ちなみにローカルIPアドレスとか言います。

Windowsなら、設定アプリを開く→ネットワークとインターネット→「状態」のプロパティを開く→下の方にスクロールしてIPv4アドレスの項目にあります。

![完成図](/image/18370B89-9C77-4D61-B7D7-5267E34FD779.gif)

MacやLinuxの場合も、設定アプリなどから確認できます。(詳しくは検索してください)

そしたら、IPアドレスをMinecraftのサーバー追加欄のIPアドレスに入力します。ポートはそのまま。


入れたでしょうか？うまく行かない場合は聞きましょう。

### Windows10版でサーバー機と同じPCでサーバーに入る
この場合、自分自身にアクセスすることになるのでちょっと小細工が必要です。
ループバックを有効にします。
検索にPowershellと入力、開いて

```powershell
CheckNetIsolation LoopbackExempt -a -n="Microsoft.MinecraftUWP_8wekyb3d8bbwe"
```
を入力し、Enterを押せばMinecraftがループバックできるようになる、はずです。

参考記事: <https://yomi-note.com/games/minectaft/477/> on 2021/11/13

----
次は、同じネットワークに繋いでいないお友達も参加できるようにしてみましょう。


## サーバーに外部から入れるようにする
### ルーターの設定
そもそも、今はセキュリティとかの関係もあって、ルーターさん(ネットワーク用の機械)などは面識のない怪しい通信は追い返し、必要な通信だけを通す、という仕組みが備わっています。  
しかしながら、サーバーというのはルーターさんが知らない人からの通信がやってきます。なので、ルーターさんには「Minecraftの通信が来たら俺目当てだから俺に回しといてくれや」という指示をしておく必要があります。    

さて、そのための機能が**ポートフォワーディング**(**ポート開放**とも)というものです。


自宅サーバーの場合、手動でルーターの設定をいじることでポートフォワーディングすることができます。ただし、ネットワークの問題でできないこともあります。~~SoftBank Airとかな！~~  
設定方法は使っているルーターの種類によってまちまちなので、「ルーターの名前 ポート開放」とかでgoogleで検索しましょう。よほどマイナーな機械じゃない限り使えるサイトがあるはず。
 - 以下は ポート開放の時に必要になりそうな情報たちです。
   - 「ポート開放する機械のIPアドレス」or「LAN側のIPアドレス」は上で調べたローカルIPアドレス。
   - 「プロトコル」は、「UDP」。
   - 「ポート」は「19132」。
### IPアドレスの確認
え？さっきもやったって？うん…まぁそうなんだけど、今回やるのは「グローバルIPアドレス」ってやつです。さっきやったローカルIPアドレスの方はルーターの中でしか通用しないので、ルーターより外のインターネットで通用するIPアドレスを調べます。

とはいえこれは簡単です。[ここ](https://www.cman.jp/network/support/go_access.cgi)とかにアクセスすると教えてくれるので、メモってください。

### ようやく入れる

設定が終われば、Minecraftのサーバー追加画面に今調べたIPアドレスを打ち込めば誰でもサーバーに入ることができます。お疲れさまでした！

!!! warning
 - ポートフォワーディングはネットワークに穴をあけるような事です。具体的に言うと郵便物のために窓全開にするイメージ。なので、郵便物のふりをした爆弾とかが送られる可能性がなくはないです。むやみにしないほうがいいです。
 - IPアドレスを公開するのは、「我が家に遊びに来てね！住所は──」って叫ぶのと大して変わりません。信用できる人だけに教える、セキュリティガチガチにするなどの対策が大事です。
   - ちなみに、公開されてるサーバーは他のサーバーを中継させて被害を減らしているらしいです


## tips
### IPアドレスについて
「あれ？サーバーIPのとこに入力するのってexample.comみたいな形式じゃなかったっけ？」と疑問に思った方もいると思います。  
実は、example.comとかは〇〇.〇〇.〇〇.〇〇の形式の「あだ名」です。webサイトとかもですが、アドレスにいちいち数字を打ち込むのは分かりづらいので、こんな仕組みが用意されています。
### ポートって何？
サーバーに入るときに入力するポートについて今回一切触れませんでしたが、ポートは役所の窓口みたいなやつです。具体的には通信を「WEBページは80番」「メールは110番」のように種類ごとに分けます。そうすると、各種ソフトは担当の番号だけ見ていればいいので、相当楽になるわけです。で、Minecraftは標準で19132番を使っています。あえていじる必要もないので、ノータッチです。
